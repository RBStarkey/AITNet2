@page "/DemoNINumber"
@using System.Text.RegularExpressions;

<label class="control-label">NI Number</label>
<div class="input-group mb-3">
    <input @bind="NINumber" type="text" class="form-control" @onkeyup="@(e=> NiNoOnKeyUp(e))" @onfocus="@(e=> NiNoOnFocus(e))"
           style="font-weight:700" spellcheck="false" />
    <button class="@ButtonClass btn-sm ml-2" style="width:5em" @onclick="NiNoTestOnClick">@ButtonCaption</button>
</div>
@if (ErrorMessage.Length > 0)
    {
    <div class="alert alert-danger mt-2" role="alert">
        <span class="oi oi-warning" style="font-size:1.5em;color:red" aria-hidden="true"></span>
        <button type="button" class="close ml-auto" aria-label="Close" @onclick="HideErrorMessage">
            <span aria-hidden="true">&times;</span>
        </button>&nbsp;@ErrorMessage.ToString()
    </div>
    }
@code {
    private string ButtonCaption = "Test";
    private string ButtonClass = "btn btn-primary";
    private string ErrorMessage = string.Empty;
    private string NINumber = string.Empty;
    private readonly string TickMark = "✔";
    private readonly string CrossMark = "✘";

    private void NiNoTestOnClick(MouseEventArgs e)
        {
        Regex rx = new Regex(@"[A-CEGHJ-PR-TW-Z]{1}[A-CEGHJ-NPR-TW-Z]{1}\s?[0-9]{2}\s?[0-9]{2}\s?[0-9]{2}\s?[A-DFMP ]");

        NINumber = NINumber.Trim();
        if (NINumber.Length == 0)
            {
            ErrorMessage = "Please type a National Insurance Number";
            ButtonClass = "btn btn-danger";
            ButtonCaption = CrossMark;
            return;
            }
        if (NINumber.Length > 0)
            {
            if (rx.IsMatch(NINumber))
                {
                ErrorMessage = string.Empty;
                ButtonClass = "btn btn-success";
                ButtonCaption = TickMark;
                }
            else
                {
                ErrorMessage = "NiNo Not well formed.";
                ButtonClass = "btn btn-danger";
                ButtonCaption = CrossMark;
                }
            }
        }

    private void HideErrorMessage()
        {
        ErrorMessage = string.Empty;
        ButtonClass = "btn btn-primary";
        ButtonCaption = "Test";
        }
    private void NiNoOnKeyUp(KeyboardEventArgs e)
        {
        ErrorMessage = string.Empty;
        ButtonClass = "btn btn-primary";
        ButtonCaption = "Test";
        }
    private void NiNoOnFocus(FocusEventArgs e)
        {
        HideErrorMessage();
        }

}

